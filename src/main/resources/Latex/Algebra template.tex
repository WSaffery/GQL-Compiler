\documentclass[fleqn]{article}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{listings}
\usepackage{semantic}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{fancyvrb}
\usepackage{textcomp}
\usepackage{adjustbox}
\usepackage{stmaryrd}

\renewcommand{\arraystretch}{1.2}

\newcommand{\rel}[1][]{ \vDash_{#1}}
% old bug: places \rel with nothing following, needed to manually add an empty {} pair (for my compiler anyway)
% fix: additional [] adds blank default value for first argument

\newcommand{\sem}[1]{\llbracket #1 \rrbracket_{D,G}}
\newcommand{\semex}[1]{\llbracket #1 \rrbracket_{D,G,u}}
\newcommand{\til}{\raisebox{0.6ex}{\textcolor{black}{\textbf{\texttildelow}}}}

% colors
\definecolor{GQLBlue}{RGB}{4,0,127}

\newcommand\bluetext[1]{{\allowbreak\bluetextcolor{#1}}}
\newcommand{\mathblue}[1]{\textsf{\bluetext{#1}}}

\newcommand\bluetextcolor[1]{{\textcolor{GQLBlue}{%
    \large\ttfamily\bfseries{\detokenize{#1}}}}}
\def\mystrut{\rule[\dimexpr-\dp\strutbox+\fboxsep]{0pt}{%
    \dimexpr\normalbaselineskip-2\fboxsep}}
\def\grayspace{\hspace{0pt minus \fboxsep}}


\lstdefinestyle{customc}{
    belowcaptionskip=1\baselineskip,
    breaklines=true,
    frame=none,
    basicstyle=\normalsize\ttfamily\color[RGB]{50,50,50},
    keywordstyle=\color[RGB]{4,0,127},
    commentstyle=\itshape\color{green!40!black},
    mathescape=true,
    extendedchars=true,
    columns=fullflexible,
    escapeinside=''
}

\lstset{style=customc}

\begin{document}
\begin{align*}
    G &= g3 \\
    \chi_{1} &= (x, \{\{Person\}\}, \emptyset) \\
    \pi_{1} &= \chi_{1} \\
    \rel &= \rel{W} \\
    \Bar{\pi} &= (\pi_{1}) \\
    \rel &= (\rel{1}) \\
    T &= \{()\} \\
    M_{1} &= \sem{\mathblue{MATCH } \Bar{\pi}}(T) = \biguplus_{u \in T} \{u \times u' \mid u' \in \textsf{match}(\Bar{\pi}, G, u, \rel)\} \\
    Q_1 &= \sem{\mathblue{RETURN ALL } \*}(M_{1}) = M_{1} \\
    G &= g3 \\
    \chi_{2} &= (x, \{\{Professor\}\}, \emptyset) \\
    \pi_{2} &= \chi_{2} \\
    \rel{2} &= \rel{W} \\
    \Bar{\pi} &= (\pi_{2}) \\
    \rel{} &= (\rel{2}) \\
    T &= \{()\} \\
    M_{1} &= \sem{\mathblue{MATCH } \Bar{\pi}}(T) = \biguplus_{u \in T} \{u \times u' \mid u' \in \textsf{match}(\Bar{\pi}, G, u, \rel{})\} \\
    Q_2 &= \sem{\mathblue{RETURN ALL } x}(M_{1}) = \biguplus_{u \in M_{1}} \{(x: \semex{x})\} \\
    Q_{1, 2} &= \sem{Q_{1} \mathblue{ UNION ALL }Q_2}(T) = Q_{1} \biguplus Q_2 \\
\end{align*}
\end{document}
